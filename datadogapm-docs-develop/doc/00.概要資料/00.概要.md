# Datadog移行作業

**目次**
- [1. ドキュメントの概要](#1-ドキュメントの概要)
- [2. 前提条件](#2-前提条件)

## 1. 作業概要

- Datadog移行作業において、事前作業、検証作業、本番適用作業があり、各担当が対応する。
  
| 区分 | 想定タスク | タスク内容 | 想定作業ボリューム |  案件業務担当 | 案件インフラ担当 | 
|-----|-----|-----|-----|-----|-----| 
| 事前 | 事前確認 | 手順書の確認 | 1日 | ○ | ○ | 
|  | 事前作業 | Dynatraceバージョン確認 | 数時間 | ○ |  | 
|  |  | Dynatraceバージョンアップ無効化 |  |  | ○ | 
|  |  | Dynatraceバージョン固定化 |  |  | ○ | 
| 検証 | 導入検証 | Dynatrace削除 | 1日 | ○<br>（自動ルート以外） | ○<br>（自動ルート） | 
|  |  | APM有効化 |  |  | ○ | 
|  |  | APM設定 |  | ○ |  | 
|  |  | アプリケーションデプロイ |  | ○ |  | 
|  | 動作確認 | DatadogのAPM機能が動いていることを確認し、Datadogの基本動作を確認する | 1週間 | ○ |  | 
|  |  | 標準ダッシュボードの確認 |  | ○ |  | 
|  |  | カスタムダッシュボード作成 |1週間  | ○ |  | 
| 本番適用 | Dynatraceアンインストール |【自動ルート】・DynatraceのPodを削除<br/>【自動ルート以外】・Deployment.ymlにてDynatraceのAgent部分の削除| 数時間～半日程度 | ○<br>（自動ルート以外） | ○<br>（自動ルート） | 
|  |DatadogのAPM有効化  | DatadogのAPM機能をONにする。 |  |  | ○ | 
|  |DatadogのAPM設定  | DeploymentにDatadogタグを追加する。 |  | ○ |  | 
|  |アプリケーションデプロイ  | アプリケーションをデプロイする。 |  | ○ |  | 
|  | 動作確認 | DatadogのAPM機能が動いていることを確認し、Datadogの基本動作を確認する。開発環境で作られたダッシュボードテンプレートを適用する。 | 数時間 | ○ |  | 


## 2. 事前作業

- 事前作業では、まず手順書の確認を行い、移行作業に必要な内容を把握する。
- Dynatraceのバージョン確認を行い、バージョンアップが無効化されていることを確認し、Dynatraceのバージョン固定化も実施し、切り戻り対応の準備を行う。  
  - [01.DynatraceAgentバージョン確認手順](../01.Datadog導入資料/01.DynatraceAgentバージョン確認手順.md)

## 3. 検証作業

- 検証作業では、まずDynatraceの削除を行い、その後、DatadogのAPM機能を有効化し設定する。
  - [02.Dynatrace環境削除手順](../01.Datadog導入資料/02.Dynatrace環境削除手順.md)  
  - [03.DatadogAPM設定手順](../01.Datadog導入資料/03.DatadogAPM設定手順)  
  
  ※監査トータル向けのプロジェクトは以下を参照。
  - [02.Dynatrace環境削除手順（監査トータル向け）](../01.Datadog導入資料/02.Dynatrace環境削除手順（監査トータル向け）.md)  
  - [03.DatadogAPM設定手順（監査トータル向け）](../01.Datadog導入資料/03.DatadogAPM設定手順（監査トータル向け）.md)
     
- APMの動作確認として、DatadogのAPM機能が正しく動作しているかを確認し、基本的な動作が問題ないことを確認する。  
  さらに、標準ダッシュボードの確認や、必要に応じてカスタムダッシュボードの作成も行い、Datadogの環境を調整する。検証作業全体には約1週間の期間が見込まれる。
  - [04.Datadog動作確認手順](../01.Datadog導入資料/04.Datadog動作確認手順.md)

## 4. 本番適用作業

- 本番適用作業では、まずDynatraceを削除し、自動ルートや自動ルート以外の対応に分かれて作業を進める。
  - [02.Dynatrace環境削除手順](../01.Datadog導入資料/02.Dynatrace環境削除手順.md)  
  
  ※監査トータル向けのプロジェクトは以下を参照。
  - [02.Dynatrace環境削除手順（監査トータル向け）](../01.Datadog導入資料/02.Dynatrace環境削除手順（監査トータル向け）.md)  

- DatadogのAPM機能を有効化し、DeploymentにDatadogタグを追加する。
  - [03.DatadogAPM設定手順](../01.Datadog導入資料/03.DatadogAPM設定手順)  
  
  ※監査トータル向けのプロジェクトは以下を参照。
  - [03.DatadogAPM設定手順（監査トータル向け）](../01.Datadog導入資料/03.DatadogAPM設定手順（監査トータル向け）.md) 
  
- その後、アプリケーションのデプロイを行い、DatadogのAPM機能が正常に動作していることを確認する。デプロイ時にサービスの瞬断が発生する。  
  さらに、開発環境で作成したダッシュボードテンプレートを適用し、本番環境でも同様の監視が行えることを確認する。
  - [04.Datadog動作確認手順](../01.Datadog導入資料/04.Datadog動作確認手順.md)
